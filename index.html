<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Passport Photo Maker</title>

<style>
body{
  margin:0;
  padding:16px;
  background:#0e0e0e;
  font-family:system-ui,-apple-system,"Segoe UI",Roboto;
  color:#e6ffe6;
}
h2{
  text-align:center;
  margin-bottom:18px;
  color:#7CFFB2;
}

/* TOOLBAR */
.toolbar{
  max-width:920px;
  margin:auto;
  background:#151515;
  border-radius:14px;
  padding:20px;
  border:1px solid #2cff9a;
}

/* SECTION */
.section{margin-bottom:22px}
.section-title{
  font-size:14px;
  margin-bottom:10px;
  color:#9affc8;
}

/* FLEX */
.flex{
  display:flex;
  flex-wrap:wrap;
  gap:14px;
  align-items:center;
}

/* FILE */
.file-wrap{position:relative}
.file-wrap input{
  position:absolute;
  inset:0;
  opacity:0;
}
.file-btn{
  padding:12px 28px;
  border-radius:12px;
  background:#2cff9a;
  border:none;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  color:#002b1c;
}

/* OPTIONS */
label{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:14px;
}
input[type=radio],
input[type=checkbox]{
  accent-color:#2cff9a;
}

/* INPUTS */
input[type=number],select{
  width:120px;
  background:#0b0b0b;
  color:#e6ffe6;
  border:1px solid #2cff9a;
  border-radius:8px;
  padding:8px;
}
select{width:auto}

/* BUTTONS */
.btn{
  padding:10px 22px;
  border-radius:10px;
  border:1px solid #2cff9a;
  background:transparent;
  color:#7CFFB2;
  cursor:pointer;
}
.btn.primary{
  background:#2cff9a;
  color:#002b1c;
  border:none;
}

/* CANVAS */
canvas{
  display:block;
  width:100%;
  max-width:720px;
  margin:22px auto 0;
  background:#fff;
  border-radius:6px;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}

/* ðŸ”¥ modal box */
.modal-box{
  position:relative;              /* important */
  background:#141414;
  width:92%;
  max-width:320px;
  border-radius:12px;
  padding:16px 16px 18px;
  border:1px solid #2cff9a;
}

/* close button INSIDE popup */
.close{
  position:absolute;
  top:8px;
  right:10px;
  font-weight:bold;
  color:#ff6b6b;
  cursor:pointer;
}

.modal h3{
  margin:0 0 14px;
  text-align:center;
}

.modal .row{
  margin-bottom:12px;
}
.modal input[type=number]{
  width:100%;
}
</style>
</head>

<body>

<h2>Passport Size Photo Maker</h2>

<div class="toolbar">

  <div class="section">
    <div class="section-title">Choose Photo</div>
    <div class="flex">
      <div class="file-wrap">
        <button class="file-btn">Choose Photo</button>
        <input type="file" id="upload" accept="image/*">
      </div>
    </div>
  </div>

  <div class="section">
    <div class="section-title">Photo Size</div>
    <div class="flex">
      <label><input type="radio" name="mode" value="passport" checked> Passport Size</label>
      <label><input type="radio" name="mode" value="manual"> Manual Size</label>
    </div>
  </div>

  <div class="section">
    <label><input type="checkbox" id="border"> Photo Border</label>
  </div>

  <div class="section">
    <div class="section-title">Select Paper Size</div>
    <select id="paper">
      <option value="A4" selected>A4</option>
      <option value="A5">A5</option>
      <option value="A6">A6</option>
      <option value="LETTER">Letter</option>
    </select>
  </div>

  <div class="section">
    <div class="section-title">Photo Count</div>
    <input type="number" id="count" value="4" min="1">
  </div>

  <div class="section flex">
    <button class="btn primary" onclick="downloadPNG()">Download PNG</button>
    <button class="btn" onclick="downloadJPG()">Download JPG</button>
  </div>

</div>

<canvas id="c"></canvas>

<!-- MANUAL SIZE POPUP -->
<div class="modal" id="modal">
  <div class="modal-box">
    <span class="close" onclick="closeModal()">âœ–</span>

    <h3>Manual Size</h3>

    <div class="row flex">
      <label><input type="radio" name="unit" value="cm" checked> CM</label>
      <label><input type="radio" name="unit" value="mm"> MM</label>
    </div>

    <div class="row">
      <input type="number" id="mw" placeholder="Width">
    </div>

    <div class="row">
      <input type="number" id="mh" placeholder="Height">
    </div>

    <div class="row flex" style="justify-content:center">
      <button class="btn primary" onclick="applyManual()">Apply</button>
    </div>
  </div>
</div>

<script>
/* LOGIC SAME */

const c=document.getElementById("c");
const ctx=c.getContext("2d");

const PAPERS={A4:{w:2480,h:3508},A5:{w:1748,h:2480},A6:{w:1240,h:1748},LETTER:{w:2550,h:3300}};
const PER_ROW=7,GAP_X=20,GAP_Y=25,MARGIN=40;
const PASSPORT_RATIO=4.5/3.5,DPI_CM=118.11;

let img=null,mode="passport",paperW=2480,paperH=3508,photoW=0,photoH=0;

function setPaper(){
  const p=PAPERS[paper.value];
  paperW=p.w;paperH=p.h;
  c.width=paperW;c.height=paperH;
}
setPaper();

document.querySelectorAll("input[name=mode]").forEach(r=>{
  r.onchange=e=>{
    mode=e.target.value;
    if(mode==="manual") modal.style.display="flex";
    else draw(false);
  };
});

paper.onchange=()=>{setPaper();draw(false)};
count.oninput=()=>draw(false);
border.onchange=()=>draw(false);

upload.onchange=e=>{
  const r=new FileReader();
  r.onload=v=>{
    img=new Image();
    img.onload=()=>draw(false);
    img.src=v.target.result;
  };
  r.readAsDataURL(e.target.files[0]);
};

function draw(isJPG){
  ctx.clearRect(0,0,paperW,paperH);
  if(isJPG){
    ctx.fillStyle="#fff";
    ctx.fillRect(0,0,paperW,paperH);
  }
  if(!img)return;

  let total=+count.value;
  let usableW=paperW-(MARGIN*2)-(GAP_X*(PER_ROW-1));
  photoW=usableW/PER_ROW;
  photoH=(mode==="passport")?photoW*PASSPORT_RATIO:photoH;

  let maxRows=Math.floor((paperH-(MARGIN*2))/(photoH+GAP_Y));
  total=Math.min(total,maxRows*PER_ROW);

  for(let i=0;i<total;i++){
    let col=i%PER_ROW,row=Math.floor(i/PER_ROW);
    let x=MARGIN+col*(photoW+GAP_X);
    let y=MARGIN+row*(photoH+GAP_Y);
    ctx.drawImage(img,x,y,photoW,photoH);
    if(border.checked){
      ctx.strokeStyle="#000";
      ctx.lineWidth=2;
      ctx.strokeRect(x,y,photoW,photoH);
    }
  }
}

function downloadPNG(){draw(false);let a=document.createElement("a");a.href=c.toDataURL("image/png");a.download="photo_sheet.png";a.click();}
function downloadJPG(){draw(true);let a=document.createElement("a");a.href=c.toDataURL("image/jpeg",1);a.download="photo_sheet.jpg";a.click();}

function closeModal(){modal.style.display="none"}
function applyManual(){
  let unit=document.querySelector("input[name=unit]:checked").value;
  let w=+mw.value,h=+mh.value;
  if(!w||!h)return;
  if(unit==="mm"){w/=10;h/=10}
  photoW=w*DPI_CM;photoH=h*DPI_CM;
  closeModal();draw(false);
}
</script>

</body>
</html>
